<!DOCTYPE HTML>
<html><head><link rel="stylesheet" type="text/css" href="../../../../bootstrap.min.css"><link rel="stylesheet" type="text/css" href="../../../../style.css"><title>Control.Monad.Rec.Class</title></head><body><div class="navbar navbar-default"><div class="container"><div class="navbar-header"><a class="navbar-brand">Core Libraries</a></div><ul class="nav navbar-nav"><li><a href="../../../../index.html">Contents</a></li><li><a href="../../../../index/index.html">Index</a></li></ul></div></div><div class="container" id="content"><h1>Control.Monad.Rec.Class</h1><a name="MonadRec" href="#MonadRec"><h2><code>MonadRec</code></h2></a><p class="decl"><code><span class="keyword">class</span> <span class="syntax">(</span><a href="../../../../Prelude/index.html#Monad"><span class="ctor">Monad</span></a> <span class="ident">m</span><span class="syntax">) &lt;=</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span> <span class="keyword">where</span></code></p><ul><li><code><span class="ident">tailRecM</span> <span class="syntax">::</span> <span class="keyword">forall</span> <span class="ident">a</span> <span class="ident">b</span><span class="syntax">.</span> <span class="syntax">(</span><span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="syntax">(</span><a href="../../../../Data/Either/index.html#Either"><span class="ctor">Either</span></a> <span class="ident">a</span> <span class="ident">b</span><span class="syntax">)</span><span class="syntax">)</span> <span class="syntax">-&gt;</span> <span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="ident">b</span></code></li></ul><p>This type class captures those monads which support tail recursion in constant stack space.</p>
<p>The <code>tailRecM</code> function takes a step function, and applies that step function recursively
until a return value of type <code>b</code> is found.</p>
<p>Instances are provided for standard monad transformers.</p>
<p>For example:</p>
<pre class="purescript"><code>loopWriter :: Number -&gt; WriterT Sum (Eff (trace :: Trace)) Unit
loopWriter n = tailRecM go n
  where
  go 0 = do
    lift $ trace &quot;Done!&quot;
    return (Right unit)
  go n = do
    tell $ Sum n  
    return (Left (n - 1))
</code></pre>
<a name="tailRecM2" href="#tailRecM2"><h2><code>tailRecM2</code></h2></a><p class="decl"><code><span class="ident">tailRecM2</span> <span class="syntax">::</span> <span class="keyword">forall</span> <span class="ident">m</span> <span class="ident">a</span> <span class="ident">b</span> <span class="ident">c</span><span class="syntax">.</span> <span class="syntax">(</span><a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">)</span> <span class="syntax">=&gt;</span> <span class="syntax">(</span><span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">b</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="syntax">(</span><a href="../../../../Data/Either/index.html#Either"><span class="ctor">Either</span></a> <span class="syntax">{</span> <span class="ident">a</span> <span class="syntax">::</span> <span class="ident">a</span><span class="syntax">,</span> <span class="ident">b</span> <span class="syntax">::</span> <span class="ident">b</span> <span class="syntax">}</span> <span class="ident">c</span><span class="syntax">)</span><span class="syntax">)</span> <span class="syntax">-&gt;</span> <span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">b</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="ident">c</span></code></p><ul></ul><p>Create a tail-recursive function of two arguments which uses constant stack space.</p>
<a name="tailRecM3" href="#tailRecM3"><h2><code>tailRecM3</code></h2></a><p class="decl"><code><span class="ident">tailRecM3</span> <span class="syntax">::</span> <span class="keyword">forall</span> <span class="ident">m</span> <span class="ident">a</span> <span class="ident">b</span> <span class="ident">c</span> <span class="ident">d</span><span class="syntax">.</span> <span class="syntax">(</span><a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">)</span> <span class="syntax">=&gt;</span> <span class="syntax">(</span><span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">b</span> <span class="syntax">-&gt;</span> <span class="ident">c</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="syntax">(</span><a href="../../../../Data/Either/index.html#Either"><span class="ctor">Either</span></a> <span class="syntax">{</span> <span class="ident">a</span> <span class="syntax">::</span> <span class="ident">a</span><span class="syntax">,</span> <span class="ident">b</span> <span class="syntax">::</span> <span class="ident">b</span><span class="syntax">,</span> <span class="ident">c</span> <span class="syntax">::</span> <span class="ident">c</span> <span class="syntax">}</span> <span class="ident">d</span><span class="syntax">)</span><span class="syntax">)</span> <span class="syntax">-&gt;</span> <span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">b</span> <span class="syntax">-&gt;</span> <span class="ident">c</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="ident">d</span></code></p><ul></ul><p>Create a tail-recursive function of three arguments which uses constant stack space.</p>
<a name="tailRec" href="#tailRec"><h2><code>tailRec</code></h2></a><p class="decl"><code><span class="ident">tailRec</span> <span class="syntax">::</span> <span class="keyword">forall</span> <span class="ident">a</span> <span class="ident">b</span><span class="syntax">.</span> <span class="syntax">(</span><span class="ident">a</span> <span class="syntax">-&gt;</span> <a href="../../../../Data/Either/index.html#Either"><span class="ctor">Either</span></a> <span class="ident">a</span> <span class="ident">b</span><span class="syntax">)</span> <span class="syntax">-&gt;</span> <span class="ident">a</span> <span class="syntax">-&gt;</span> <span class="ident">b</span></code></p><ul></ul><p>Create a pure tail-recursive function of one argument</p>
<p>For example:</p>
<pre class="purescript"><code>pow :: Number -&gt; Number -&gt; Number
pow n p = tailRec go { accum: 1, power: p }
  where
  go :: _ -&gt; Either _ Number
  go { accum: acc, power: 0 } = Right acc
  go { accum: acc, power: p } = Left { accum: acc * n, power: p - 1 }
</code></pre>
<a name="monadRecIdentity" href="#monadRecIdentity"><h2><code>monadRecIdentity</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecIdentity</span> <span class="syntax">::</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <a href="../../../../Data/Identity/index.html#Identity"><span class="ctor">Identity</span></a> <span class="keyword">where</span></code></p><ul></ul><a name="monadRecEff" href="#monadRecEff"><h2><code>monadRecEff</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecEff</span> <span class="syntax">::</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="syntax">(</span><a href="../../Eff/index.html#Eff"><span class="ctor">Eff</span></a> <span class="ident">eff</span><span class="syntax">)</span> <span class="keyword">where</span></code></p><ul></ul><a name="monadRecMaybeT" href="#monadRecMaybeT"><h2><code>monadRecMaybeT</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecMaybeT</span> <span class="syntax">::</span> <span class="syntax">(</span><a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">) =&gt;</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="syntax">(</span><a href="../../Maybe/Trans/index.html#MaybeT"><span class="ctor">MaybeT</span></a> <span class="ident">m</span><span class="syntax">)</span> <span class="keyword">where</span></code></p><ul></ul><a name="monadRecErrorT" href="#monadRecErrorT"><h2><code>monadRecErrorT</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecErrorT</span> <span class="syntax">::</span> <span class="syntax">(</span><a href="../../Error/index.html#Error"><span class="ctor">Error</span></a> <span class="ident">e</span><span class="syntax">,</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">) =&gt;</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="syntax">(</span><a href="../../Error/Trans/index.html#ErrorT"><span class="ctor">ErrorT</span></a> <span class="ident">e</span> <span class="ident">m</span><span class="syntax">)</span> <span class="keyword">where</span></code></p><ul></ul><a name="monadRecWriterT" href="#monadRecWriterT"><h2><code>monadRecWriterT</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecWriterT</span> <span class="syntax">::</span> <span class="syntax">(</span><a href="../../../../Data/Monoid/index.html#Monoid"><span class="ctor">Monoid</span></a> <span class="ident">w</span><span class="syntax">,</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">) =&gt;</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="syntax">(</span><a href="../../Writer/Trans/index.html#WriterT"><span class="ctor">WriterT</span></a> <span class="ident">w</span> <span class="ident">m</span><span class="syntax">)</span> <span class="keyword">where</span></code></p><ul></ul><a name="monadRecStateT" href="#monadRecStateT"><h2><code>monadRecStateT</code></h2></a><p class="decl"><code><span class="keyword">instance</span> <span class="ident">monadRecStateT</span> <span class="syntax">::</span> <span class="syntax">(</span><a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">) =&gt;</span> <a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="syntax">(</span><a href="../../State/Trans/index.html#StateT"><span class="ctor">StateT</span></a> <span class="ident">s</span> <span class="ident">m</span><span class="syntax">)</span> <span class="keyword">where</span></code></p><ul></ul><a name="forever" href="#forever"><h2><code>forever</code></h2></a><p class="decl"><code><span class="ident">forever</span> <span class="syntax">::</span> <span class="keyword">forall</span> <span class="ident">m</span> <span class="ident">a</span> <span class="ident">b</span><span class="syntax">.</span> <span class="syntax">(</span><a href="#MonadRec"><span class="ctor">MonadRec</span></a> <span class="ident">m</span><span class="syntax">)</span> <span class="syntax">=&gt;</span> <span class="syntax">(</span><span class="ident">m</span> <span class="ident">a</span><span class="syntax">)</span> <span class="syntax">-&gt;</span> <span class="ident">m</span> <span class="ident">b</span></code></p><ul></ul><p><code>forever</code> runs an action indefinitely, using the <code>MonadRec</code> instance to
ensure constant stack usage.</p>
<p>For example:</p>
<pre class="purescript"><code>main = forever $ trace &quot;Hello, World!&quot;
</code></pre>
</div></body></html>